# Forge of Thought - Master Plan V3 Gap Report

This report outlines the current status of the project codebase against the tasks defined in `instructions.md` (Master Plan V3) and provides a prioritized action list to reach the MVP, reflecting updated file path information.

## Task Status Breakdown

| Phase          | Task                                                                | Status              | Next Action                                                                                                | Evidence / Notes                                                                                                                                       |
|----------------|---------------------------------------------------------------------|---------------------|------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|
| **1: Reset**   | 1.1 Replace default logger import                                   | Not started         | Replace `import logger` with `import { logger }` in `frontend/src/store/canvasStore.ts`.                   | `canvasStore.ts` L32 uses default import.                                                                                                                |
|                | 1.2 Delete/merge duplicates                                         | Partial             | Manually check for/delete duplicate `chroma_data` directories, confirm seed script uniqueness.             | Root and `backend/` contain `chroma_data`. `scripts/` contains seed files. Needs audit. (`backend/api.ts` confirmed deprecated).                  |
|                | 1.3 Ensure .env variables                                         | Partial             | Create/update `.env.example` with necessary API keys, Neo4j, Chroma vars. Ensure `config.py` expects them. | `backend/app/core/config.py` uses `os.getenv`. `OPENAI_API_KEY` handling unclear. `.env.example` needs verification/creation.                                         |
|                | 1.4 Add linting & pre-commit                                      | Not started         | Create `pyproject.toml` with `ruff` & `black`. Set up `pre-commit` hooks.                                    | `pyproject.toml` not created yet. `frontend/package.json` has `lint`.                                                                                  |
|                | 1.5 Update README quick-start                                       | Not started         | Create root `README.md` with 3-command setup instructions.                                                 | Root `README.md` missing.                                                                                                                                |
| **2: Models**  | 2.1 Unify NodeData/EdgeData                                         | Partial             | Compare `NodeData`/`EdgeData` in `backend/app/models/data_models.py` & `frontend/src/types/api.ts`. Align fields (esp. source/target).            | Models exist. Frontend `GraphStructure` transformation suggests divergence. Requires detailed comparison.                                                |
|                | 2.2 Clarify edge fields documentation                             | Partial             | Review/update inline docs for `semantic_type` / `internal_type` in `data_models.py` & `api.ts`.              | Docs exist but clarity/completeness requires review.                                                                                                     |
|                | 2.3 Add OpenAPI examples                                            | Not started         | Add `@Body(examples=...)` to `/synthesis` POST in `backend/app/api/endpoints/synthesis.py` and create/document POST `/edges` endpoint in `backend/app/api/endpoints/concepts.py`.                 | `synthesis.py` lacks examples. `/edges` POST endpoint missing in `concepts.py`.                                                                         |
|                | 2.4 Write failing pytest for /synthesis                             | Partial             | Modify `test_basic_synthesis` to assert a specific non-200 code initially OR add setup validation.        | `test_synthesis.py` exists but asserts 200 OK, not a failing state first.                                                                              |
| **3: Canvas**  | 3.1 Split canvasStore.ts                                            | Not started         | Refactor `frontend/src/store/canvasStore.ts` into `graphSlice.ts` and `uiSlice.ts`.                                         | `canvasStore.ts` is monolithic (1153 lines).                                                                                                             |
|                | 3.2 Replace hardcoded node lookup                                   | Not started         | Add `GET /concepts/random` endpoint in `backend/app/api/endpoints/concepts.py`. Call it on FE load and replace `initialNodes`.                        | `canvasStore.ts` uses hardcoded `test-node-with-ki`. `/concepts/random` endpoint missing.                                                                |
|                | 3.3 Implement temp edge -> modal flow (IS type)                   | Not implemented - must be created | Create `frontend/src/components/panels/RelationshipSelectorModal.tsx`. Wire to `canvasStore` state.        | `canvasStore.ts` has state (`pendingConnectionParams`, etc.). Modal component must be created.                                                           |
|                | 3.4 Add Playwright test (draw IS edge)                              | Not started         | Create `frontend/tests/edge_hypothesis.spec.ts` with Playwright test for drawing an IS edge.               | `frontend/tests` directory missing.                                                                                                                      |
| **4: Synth MVP**| 4.1 Minimal SynthesisCore prompt                                  | Not started         | Simplify `_construct_llm_prompt` in `backend/app/services/synthesis_core.py` to the basic "bridge A and B" prompt.              | Current prompt logic is complex, not the minimal version specified.                                                                                    |
|                | 4.2 Backend inserts new node                                        | Done                | -                                                                                                          | `synthesis_core.py` calls `kg_interface.create_node` (using `backend/app/db/knowledge_graph_interface.py`).                                        |
|                | 4.3 Frontend adds synthesis node                                    | Done                | Verify `useEffect`/callback in `frontend/src/pages/CanvasPage.tsx` correctly adds node from API response via `addNode`.    | `canvasStore.ts` has `addNode` and calls `invokeSynthesis`. Assumed done pending UI connection verification.                                           |
|                | 4.4 Expand Playwright test (node count=3)                         | Not started         | Add assertion to `edge_hypothesis.spec.ts` checking for 3 nodes after synthesis.                           | `frontend/tests` directory missing.                                                                                                                      |
| **5: Edges**   | 5.1 Implement 12-enum SemanticEdgeType                            | Not implemented - must be created | Create `backend/app/models/enums.py`. Create `frontend/src/constants/edgeTypes.ts`. Add icons/colors.    | Enum files (`enums.py`, `edgeTypes.ts`) must be created. Need consolidation/alignment and styling assets.                                                |
|                | 5.2 SuggestionService simple heuristic                            | Partial             | Modify `suggest_edge_types` in `backend/app/services/suggestion_service.py` to use only string similarity + random weight.    | Service exists but uses complex KG/Vector logic, not the simple heuristic.                                                                             |
|                | 5.3 Extend synthesis prompt map (table-driven)                    | Partial             | Refactor `_construct_llm_prompt` in `backend/app/services/synthesis_core.py` to use a clear dictionary/table.                 | Current prompt logic is complex; needs refactoring for table-driven maintainability.                                                                   |
|                | 5.4 Add unit tests for prompt map                                   | Not implemented - must be created | Create `backend/tests/test_prompt_map.py` with tests covering edge type to prompt mapping.               | Test file `test_prompt_map.py` must be created.                                                                                                          |
| **6: Health**  | 6.1 Dockerise application                                           | Not implemented - must be created | Create `Dockerfile` for frontend, `Dockerfile` for backend, and `docker-compose.yml`.                      | Docker files (`Dockerfile`, `docker-compose.yml`) must be created.                                                                                       |
|                | 6.2 Add GitHub Action CI                                            | Not started         | Create `.github/workflows/ci.yml` with lint, test, build steps.                                          | `.github` directory missing.                                                                                                                             |
|                | 6.3 Add simple error toast                                          | Not implemented - must be created | Create `frontend/src/components/Toast.tsx`. Integrate it with `frontend/src/services/api.ts` error handling. | Toast component (`Toast.tsx`) must be created. `api.ts` error handling needs UI integration.                                                             |
|                | 6.4 Enable Neo4j uniqueness constraint                            | Done                | Verify `id` constraint in `scripts/seed_neo4j.py` targets the correct field (e.g., `ki_id`).                     | `scripts/seed_neo4j.py` includes `CREATE CONSTRAINT ... REQUIRE n.id IS UNIQUE`. Verification needed if `id` != `ki_id`.                                |
| **7: Polish**  | 7.1 Node & Edge Styling Pass                                        | Not started         | Apply colors/styles from V2 tables to nodes/edges in React Flow components.                                | Requires UI implementation/styling.                                                                                                                    |
|                | 7.2 Inspector Panel v1                                            | Partial             | Implement UI for Inspector Panel component to display data from `inspectorContent` state.                  | `canvasStore.ts` has state. UI component implementation needed.                                                                                          |
|                | 7.3 Record Loom Demo                                              | Not started         | Record the MVP demo video.                                                                                 | -                                                                                                                                                      |

## Pivot Fast-Track (Prioritized Next Actions)

This list prioritizes tasks to achieve the core MVP functionality (Phase 0 North Star) with minimal deviation, incorporating updated file information.

1.  **(1.1)** Replace `import logger` with `import { logger }` in `frontend/src/store/canvasStore.ts`.
2.  **(1.3)** Create/update `.env.example` and ensure `backend/app/core/config.py` correctly expects `NEO4J_URI`, `NEO4J_USER`, `NEO4J_PASSWORD`, `CHROMA_HOST`, `CHROMA_PORT`, `CHROMA_DB_PATH`, `OPENAI_API_KEY` (or `GOOGLE_API_KEY`). *Crucial for boot.*
3.  **(1.5)** Create root `README.md` with basic setup (seed, start-be, start-fe). *Crucial for running.*
4.  **(2.1)** Perform quick alignment check on `NodeData`/`EdgeData` between `backend/app/models/data_models.py` and `frontend/src/types/api.ts`, focusing only on fields used by the synthesis endpoint (`id`, `label`, `type`, `source`, `target`, `semantic_type`). Make minimal necessary changes for `POST /synthesis` to work.
5.  **(6.4)** Verify that the `id` field constrained in `scripts/seed_neo4j.py` is indeed the intended `ki_id` used throughout the application. If not, update the constraint script.
6.  **(3.2)** Add `GET /concepts/random` endpoint in `backend/app/api/endpoints/concepts.py` to return one existing concept.
7.  **(3.2)** Modify `frontend/src/store/canvasStore.ts` `initialNodes` to be empty, and add a `useEffect` hook (or similar) to call `/concepts/random` on load and `addNode` with the result. *Ensures canvas works without hardcoding.*
8.  **(3.1)** Perform minimal split of `canvasStore.ts`: Extract just enough node/edge state and basic actions (`addNode`, `addEdge`, `onNodesChange`, `onEdgesChange`) into a `graphSlice.ts`. Leave UI state for now.
9.  **(3.3)** Create a basic `frontend/src/components/panels/RelationshipSelectorModal.tsx` that allows selecting *only* a default edge type (e.g., `RELATES_TO`). Wire it to `canvasStore`'s `pendingConnectionParams` and `confirmRelationshipSelection` to commit the edge using `addEdge`. *Unblocks user edge creation.*
10. **(4.1)** Simplify the LLM prompt in `backend/app/services/synthesis_core.py`'s `_construct_llm_prompt` (or the method calling the LLM) to the *absolute minimal* V3 requirement: "Give a single synthesized concept that bridges [Node A Label] and [Node B Label]". Ignore complex analysis/context for now.
11. **(Verify 4.2 & 4.3)** Confirm the synthesis result node is correctly added to Neo4j (4.2 - Done) and visually appears on the frontend canvas (4.3 - Done, pending UI check). Test the full loop manually.
12. **(MVP)** At this point, the core MVP loop (add nodes, connect, synthesize, see result) should function.

*(Further steps from Phases 1, 2, 5, 6, 7 can be addressed after achieving the core MVP loop)* 